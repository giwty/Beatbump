services:

  beatbump:
    #image: ghcr.io/giwty/beatbump:latest
    build:
      dockerfile: Dockerfile
    container_name: beatbump
    ports:
      - "8080:8080"
    volumes:
      - /downloads:/downloads
      - /db:/db
    environment:
      - COMPANION_SECRET_KEY=abcd123apikeykey
      - COMPANION_URL=http://companion:8282
      - BEATBUMP_DB_PATH=/db
    restart: unless-stopped

  companion:
    image: quay.io/invidious/invidious-companion:latest
    environment:
      - SERVER_SECRET_KEY=abcd123apikeykey
    restart: unless-stopped
    expose:
      - "8282"
    logging:
      options:
        max-size: "1G"
        max-file: "4"
    cap_drop:
      - ALL
    read_only: true
    # cache for youtube library
    volumes:
      - companioncache:/var/tmp/youtubei.js:rw
    security_opt:
      - no-new-privileges:true

volumes:
  companioncache:
